{% extends "base.html" %}

{% block title %}GBB {{ year }} {{_("大会結果")}} - GBBINFO-JPN{% endblock %}
{% block twitter_title %}GBB {{ year }} {{_("大会結果")}} - GBBINFO-JPN{% endblock %}
{% block og_title %}GBB {{ year }} {{_("大会結果")}} - GBBINFO-JPN{% endblock %}
{% block og_url %}https://gbbinfo-jpn.onrender.com/{{ language }}/{{ year }}/result{% endblock %}
{% block canonical %}https://gbbinfo-jpn.onrender.com/{{ language }}/{{ year }}/result{% endblock %}
{% block content %}
<h1>GBB {{ year }} {{_("大会結果")}}</h1>

{% if is_latest_year is true %}
  <div style="text-align: center;">
    <p>{{_("最終更新")}}<br>{{ last_updated }}</p>
  </div>
{% endif %}

{% if all_category %}
  <form method="get" action="/{{ language }}/{{ year }}/result" class="participants-form">
    <label for="category">{{_("部門選択")}}</label>
    <select name="category" id="category" class="filter-select" onchange="this.form.submit()">
      {% for c in all_category %}
        <option value="{{ c }}" {% if category == c %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
  </form>
{% endif %}

{% if is_showcase is true %}
  <div style="height: 200px;"></div>
  <p style="text-align: center;">{{_("{SHOWCASE}部門は、バトルを行わないため、結果はありません。").format(SHOWCASE="SHOWCASE")}}</p>
  <div style="height: 200px;"></div>
{% elif result_type == "tournament" %}
  {% for round, data in result_data.items() %}
    <h2>{{ category }} - {{ round }}</h2>
    <table>
      <thead>
        <tr>
          <th style="width: 50%; color: rgb(255, 100, 23);">{{_("勝ち")}}</th>
          <th style="width: 10%;"></th>
          <th style="width: 40%;">{{_("負け")}}</th>
        </tr>
      </thead>
      <tbody>
        {% for match in data %}
          <tr>
            <td class="winner"><a href="/{{ language }}/participant_detail/{{ match.winner.id }}/{% if category_is_team %}team{% else %}single{% endif %}">
              {% set participant = match.winner %}
              {% include "includes/country_flag.html" %}{{ match.winner.name }}
            </a></td>
            <td>vs</td>
            <td><a href="/{{ language }}/participant_detail/{{ match.loser.id }}/{% if category_is_team %}team{% else %}single{% endif %}">
              {% set participant = match.loser %}
              {% include "includes/country_flag.html" %}{{ match.loser.name }}
            </a></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endfor %}
{% elif result_type == "ranking" %}
  {% for round, data in result_data.items() %}
    <h2>{{ category }} - {{ round }}</h2>
    <table>
      <thead>
        <tr>
          <th style="width: 20%;">{{_("順位")}}</th>
          <th style="width: 80%;">{{_("名前")}}</th>
        </tr>
      </thead>
      <tbody>
        {% for participant in data %}
          <tr>
            <td>{{ participant.rank }}</td>
            <td><a href="/{{ language }}/participant_detail/{{ participant.id }}/{% if category_is_team %}team{% else %}single{% endif %}">
              {% include "includes/country_flag.html" %}{{ participant.name }}
            </a></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endfor %}
{% else %}
  <p class="unavailable-text">{{_("発表次第更新")}}</p>
{% endif %}

{% if all_category %}
  <form method="GET" action="/{{ language }}/{{ year }}/result" class="participants-form">
    <label for="category">{{_("部門選択")}}</label>
    <select name="category" id="category" class="filter-select" onchange="this.form.submit()">
      {% for c in all_category %}
        <option value="{{ c }}" {% if category == c %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
  </form>
{% endif %}

<form method="GET" class="participants-form">
<label for="year">{{_("その他の年度を確認：")}}</label>
<select name="year" id="year" class="filter-select" onchange="redirect_year('result')">
  {% for y in available_years %}
    <option value="{{ y }}" {% if year == y %}selected{% endif %}>{{ y }}</option>
  {% endfor %}
</select>
</form>

<div class="button-container">
  <a href="/{{ language }}/{{ year - 1 }}/result"><button type="button">GBB {{ year - 1 }} {{_("大会結果")}}</button></a>
  <a href="/{{ language }}/{{ year }}/rule"><button type="button">{{_("出場権詳細")}}</button></a>
  <a href="/{{ language }}/{{ year }}/rule"><button type="button">{{_("ルール & 審査員")}}</button></a>
  <a href="/{{ language }}/{{ year }}/participants"><button>{{_("{Wildcard}結果").format(Wildcard="Wildcard")}} & {{_("出場者")}}</button></a>
</div>

{% endblock %}
