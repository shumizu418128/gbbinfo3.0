{% if is_local is true %}
<div style="position: fixed; top: 90%; left: 0; transform: translateY(-90%); z-index: 9999; background: #ff0000; color: #fff; font-size: 24px; padding: 20px 5vw; border-radius: 0 8px 8px 0; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; align-items: center;">
  <strong>LOCAL</strong><br>
  <button onclick="showDebugInfo()" style="background: none; border: 1px solid #fff; color: #fff; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 16px; display: block; margin-top: 10px;">Debug</button>
</div>
{% elif is_pull_request is true %}
<div style="position: fixed; top: 90%; left: 0; transform: translateY(-90%); z-index: 9999; background: #0000ff; color: #fff; font-size: 24px; padding: 20px 5vw; border-radius: 0 8px 8px 0; box-shadow: 0 2px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; align-items: center;">
  <strong>PR</strong><br>
  <button onclick="showDebugInfo()" style="background: none; border: 1px solid #fff; color: #fff; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 16px; display: block; margin-top: 10px;">Debug</button>
</div>
{% endif %}

<!-- JSONシンタックスハイライト用CSS -->
<style>
.json-key {
  color: #0451a5;
  font-weight: bold;
}
.json-string {
  color: #009900;
}
.json-number {
  color: #000;
  font-weight: bold;
}
.json-boolean {
  color: #0000ff;
  font-weight: bold;
}
.json-null {
  color: #808080;
  font-weight: bold;
}
</style>

<!-- デバッグ情報モーダル -->
<div id="debugModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000;">
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; padding: 20px; border-radius: 8px; width: 800px; height: 600px; overflow: auto; color: #000;">

      <!-- タブナビゲーション -->
      <div style="display: flex; margin-bottom: 20px; border-bottom: 1px solid #ddd; flex-wrap: wrap;">
        <button id="pythonTab" onclick="showTab('python')" style="background: #007bff; color: #fff; border: none; padding: 10px 15px; cursor: pointer; font-size: 14px; border-radius: 4px 4px 0 0; margin-right: 2px; margin-bottom: 2px;">Python変数</button>
        <button id="requestTab" onclick="showTab('request')" style="background: #6c757d; color: #fff; border: none; padding: 10px 15px; cursor: pointer; font-size: 14px; border-radius: 4px 4px 0 0; margin-right: 2px; margin-bottom: 2px;">リクエスト</button>
        <button id="sessionTab" onclick="showTab('session')" style="background: #6c757d; color: #fff; border: none; padding: 10px 15px; cursor: pointer; font-size: 14px; border-radius: 4px 4px 0 0; margin-right: 2px; margin-bottom: 2px;">セッション</button>
        <button id="environmentTab" onclick="showTab('environment')" style="background: #6c757d; color: #fff; border: none; padding: 10px 15px; cursor: pointer; font-size: 14px; border-radius: 4px 4px 0 0; margin-bottom: 2px;">環境情報</button>
      </div>

      <!-- コンテンツエリア -->
      <div id="pythonContent" style="font-family: 'Consolas', 'Courier New', 'Monaco', 'Menlo', monospace; white-space: pre-wrap; font-size: 16px; line-height: 1.5; background: #f8f8f8; padding: 15px; border-radius: 4px; border: 1px solid #ddd; display: block;"></div>
      <div id="requestContent" style="font-family: 'Consolas', 'Courier New', 'Monaco', 'Menlo', monospace; white-space: pre-wrap; font-size: 16px; line-height: 1.5; background: #f8f8f8; padding: 15px; border-radius: 4px; border: 1px solid #ddd; display: none;"></div>
      <div id="sessionContent" style="font-family: 'Consolas', 'Courier New', 'Monaco', 'Menlo', monospace; white-space: pre-wrap; font-size: 16px; line-height: 1.5; background: #f8f8f8; padding: 15px; border-radius: 4px; border: 1px solid #ddd; display: none;"></div>
      <div id="environmentContent" style="font-family: 'Consolas', 'Courier New', 'Monaco', 'Menlo', monospace; white-space: pre-wrap; font-size: 16px; line-height: 1.5; background: #f8f8f8; padding: 15px; border-radius: 4px; border: 1px solid #ddd; display: none;"></div>
  </div>
</div>

<script>
function showDebugInfo() {
  // Python変数
  const pythonData = {
    // 共通変数
    year: {{ year|default('null') }},
    available_years: {{ available_years|default([])|tojson }},
    lang_names: {{ lang_names|default([])|tojson }},
    language: "{{ language|default('') }}",
    is_translated: {{ is_translated|default(false)|tojson }},
    last_updated: "{{ last_updated|default('') }}",
    is_latest_year: {{ is_latest_year|default(false)|tojson }},
    is_early_access: {{ is_early_access|default(false)|tojson }},
    is_gbb_ended: {{ is_gbb_ended|default(false)|tojson }},
    is_local: {{ is_local|default(false)|tojson }},
    is_pull_request: {{ is_pull_request|default(false)|tojson }},
    scroll: "{{ scroll|default('') }}",

    // ページ専用変数（存在する場合のみ表示）
    {% if participants is defined %}
    participants: {{ participants|default([])|tojson }},
    {% endif %}
    {% if all_categories is defined %}
    all_categories: {{ all_categories|default([])|tojson }},
    {% endif %}
    {% if participant is defined %}
    participant: {{ participant|default({})|tojson }},
    {% endif %}
    {% if member is defined %}
    member: {{ member|default({})|tojson }},
    {% endif %}
    {% if gbb_seed is defined %}
    gbb_seed: {{ gbb_seed|default([])|tojson }},
    {% endif %}
    {% if other_seed is defined %}
    other_seed: {{ other_seed|default([])|tojson }},
    {% endif %}
    {% if cancelled is defined %}
    cancelled: {{ cancelled|default([])|tojson }},
    {% endif %}
    {% if search_results is defined %}
    search_results: {{ search_results|default([])|tojson }},
    {% endif %}
    {% if results is defined %}
    results: {{ results|default([])|tojson }},
    {% endif %}
    {% if ranking_results is defined %}
    ranking_results: {{ ranking_results|default([])|tojson }},
    {% endif %}
    {% if tournament_results is defined %}
    tournament_results: {{ tournament_results|default([])|tojson }},
    {% endif %}
    {% if countries is defined %}
    countries: {{ countries|default([])|tojson }},
    {% endif %}
    {% if wildcards is defined %}
    wildcards: {{ wildcards|default([])|tojson }},
    {% endif %}

    // participantsページ専用
    {% if all_category is defined %}
    all_category: {{ all_category|default([])|tojson }},
    {% endif %}
    {% if category is defined %}
    category: "{{ category|default('') }}",
    {% endif %}
    {% if ticket_class is defined %}
    ticket_class: "{{ ticket_class|default('') }}",
    {% endif %}
    {% if cancel is defined %}
    cancel: "{{ cancel|default('') }}",
    {% endif %}

    // resultページ専用
    {% if result_data is defined %}
    result_data: {{ result_data|default({})|tojson }},
    {% endif %}
    {% if result_type is defined %}
    result_type: "{{ result_type|default('') }}",
    {% endif %}
    {% if category_is_team is defined %}
    category_is_team: {{ category_is_team|default(false)|tojson }},
    {% endif %}

    // participant_detailページ専用
    {% if beatboxer_detail is defined %}
    beatboxer_detail: {{ beatboxer_detail|default({})|tojson }},
    {% endif %}
    {% if mode is defined %}
    mode: "{{ mode|default('') }}",
    {% endif %}
    {% if past_participation_data is defined %}
    past_participation_data: {{ past_participation_data|default([])|tojson }},
    {% endif %}
    {% if same_year_category_participants is defined %}
    same_year_category_participants: {{ same_year_category_participants|default([])|tojson }},
    {% endif %}
    {% if same_year_category_mode is defined %}
    same_year_category_mode: "{{ same_year_category_mode|default('') }}",
    {% endif %}
    {% if ai_search_query is defined %}
    ai_search_query: "{{ ai_search_query|default('') }}",
    {% endif %}
    {% if past_year_participation is defined %}
    past_year_participation: {{ past_year_participation|default([])|tojson }},
    {% endif %}

    // その他のページ専用変数
    {% if member is defined %}
    member: {{ member|default({})|tojson }},
    {% endif %}
    {% if country_name is defined %}
    country_name: "{{ country_name|default('') }}",
    {% endif %}

    // 注意: 新しいページ専用変数を見つけた場合は、上記のリストに手動で追加してください
    _page_type: "{{ request.endpoint|default('unknown') }}"
  };

  // リクエスト情報
  const requestData = {
    path: "{{ request.path|default('') }}",
    method: "{{ request.method|default('') }}",
    url: "{{ request.url|default('') }}",
  };

  // セッション情報
  const sessionData = {{ session|tojson }};

  // 環境情報
  const environmentData = {
    timestamp: new Date().toISOString(),
    userAgent: navigator.userAgent,
    language: navigator.language,
    platform: navigator.platform,
    cookieEnabled: navigator.cookieEnabled,
    onLine: navigator.onLine,
    screen: {
      width: screen.width,
      height: screen.height,
      colorDepth: screen.colorDepth
    },
    window: {
      innerWidth: window.innerWidth,
      innerHeight: window.innerHeight,
      location: window.location.href
    }
  };

  // 各タブにデータを設定
  document.getElementById('pythonContent').innerHTML = syntaxHighlight(JSON.stringify(pythonData, null, 2));
  document.getElementById('requestContent').innerHTML = syntaxHighlight(JSON.stringify(requestData, null, 2));
  document.getElementById('sessionContent').innerHTML = syntaxHighlight(JSON.stringify(sessionData, null, 2));
  document.getElementById('environmentContent').innerHTML = syntaxHighlight(JSON.stringify(environmentData, null, 2));

  // モーダルを表示
  document.getElementById('debugModal').style.display = 'block';
}

function closeDebugInfo() {
  document.getElementById('debugModal').style.display = 'none';
}

// タブ切り替え機能
function showTab(tabName) {
  // 全てのコンテンツを非表示
  document.getElementById('pythonContent').style.display = 'none';
  document.getElementById('requestContent').style.display = 'none';
  document.getElementById('sessionContent').style.display = 'none';
  document.getElementById('environmentContent').style.display = 'none';

  // 全てのタブボタンを非アクティブ状態に
  document.getElementById('pythonTab').style.background = '#6c757d';
  document.getElementById('requestTab').style.background = '#6c757d';
  document.getElementById('sessionTab').style.background = '#6c757d';
  document.getElementById('environmentTab').style.background = '#6c757d';

  // 選択されたタブを表示してアクティブ状態に
  document.getElementById(tabName + 'Content').style.display = 'block';
  document.getElementById(tabName + 'Tab').style.background = '#007bff';
}


// JSONシンタックスハイライト関数
function syntaxHighlight(json) {
  json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
    let cls = 'json-number';
    if (/^"/.test(match)) {
      if (/:$/.test(match)) {
        cls = 'json-key';
      } else {
        cls = 'json-string';
      }
    } else if (/true|false/.test(match)) {
      cls = 'json-boolean';
    } else if (/null/.test(match)) {
      cls = 'json-null';
    }
    return '<span class="' + cls + '">' + match + '</span>';
  });
}

// ESCキーでモーダルを閉じる
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeDebugInfo();
  }
});

// モーダル背景クリックで閉じる
document.getElementById('debugModal').addEventListener('click', function(event) {
  if (event.target === this) {
    closeDebugInfo();
  }
});
</script>
